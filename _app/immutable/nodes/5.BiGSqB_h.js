var H=Object.defineProperty;var M=(_,g,c)=>g in _?H(_,g,{enumerable:!0,configurable:!0,writable:!0,value:c}):_[g]=c;var w=(_,g,c)=>M(_,typeof g!="symbol"?g+"":g,c);import{t as Q,a as V}from"../chunks/Bxcs4qUw.js";import"../chunks/H9DnfBHD.js";import{p as X,g as b,f as Y,a as Z,m as D,s as tt,b as O}from"../chunks/D8fYKh4C.js";import{b as W}from"../chunks/bafgH-e6.js";import{i as et}from"../chunks/Co0_FZdz.js";import{R as st,a as q,l as j,I as at,G as rt,S as it}from"../chunks/D6C2-Do3.js";import{g as nt}from"../chunks/8rPLYzZg.js";var lt=Q("<div></div> <div></div>",1);function dt(_,g){X(g,!1);let c=st;c=c.filter(r=>r.outputName in q);let x=q;function F(r,s=!0){return new Promise((i,t)=>{const a=new Image;a.crossOrigin="Anonymous",a.onload=()=>i(a),a.onerror=e=>t(e),a.src=`${s?"/":""}${r}`})}function v(r){const s=document.createElement("canvas");s.width=r.width,s.height=r.height;const i=s.getContext("2d");i&&i.drawImage(r,0,0);const t=new Image;return t.src=s.toDataURL(),t}function $(r,s,i){const t=document.createElement("canvas");t.width=r,t.height=s;const a=t.getContext("2d");return a&&(a.fillStyle=i,a.fillRect(0,0,r,s)),t}let I,C,E,k;async function z(){I=await Promise.all([1,2,3,4,5].map(e=>F(`bg${e}.png`)));let r=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/ship_data.js")).text()).slice(18,-1),s=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/equip_data.js")).text()).slice(19,-1),i=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/sp_weapon_data.js")).text()).slice(23,-1),t="",a={};r.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(":")[0],a[t]={}):t!=""&&e.startsWith("painting: ")?a[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(a[t].rarity=Number(e.slice(-2,-1)))}),C=a,a={},t="",s.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(":")[0],a[t]={}):t!=""&&e.startsWith("icon: ")?a[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(a[t].rarity=Number(e.slice(-2,-1)))}),E=a,a={},t="",i.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(": {")[0],a[t]={}):t!=""&&e.startsWith("icon: ")?a[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(a[t].rarity=Number(e.slice(-2,-1)))}),k=a}class y{constructor(s){w(this,"shipId","");w(this,"gear1","");w(this,"gear2","");w(this,"gear3","");w(this,"gear4","");w(this,"gear5","");w(this,"fuckaug","");function i(t){if(t==1)return 0;if(t==2)return 6100;if(t==3)return 8100;if(t==4)return 1e4;if(t==5)return 10100;if(t==6)return 2e4}s&&s.length>1&&(this.shipId=`${s[0]}|${parseInt(s[7].slice(0,2),16)}|${i(s[8])}`,this.gear1=`${s[1]}|${parseInt(s[7][2],16)}`,this.gear2=`${s[2]}|${parseInt(s[7][3],16)}`,this.gear3=`${s[3]}|${parseInt(s[7][4],16)}`,this.gear4=`${s[4]}|${parseInt(s[7][5],16)}`,this.gear5=`${s[5]}|${parseInt(s[7][6],16)}`,this.fuckaug=`${s[6]}|${parseInt(s[7][7],16)}`)}async fetch_or_black(s,i){function t(n){return n<0?n=0:n>4&&(n=4),n}if(i=="0")return $(71,71,"black");let a;s=="equips"?(a=v(I[t(E[i].rarity-2)]),i=E[i].icon):s=="shipicon"?(a=v(I[t(C[i].rarity-2)]),i=C[i].icon):(a=v(I[t(k[i].rarity-1)]),i=k[i].icon);const e=`https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/${s}/${i}.png`;try{const n=await F(e,!1),o=document.createElement("canvas");o.width=71,o.height=71;const h=o.getContext("2d");return h&&(h.drawImage(a,0,0,71,71),h.drawImage(n,0,0,71,71)),o}catch(n){return console.log(`Error fetching ${e}: ${n}`),$(71,71,"black")}}async getImages(){if(this.shipId=="")return $(71*7,111,"black");let s=await Promise.all([this.fetch_or_black("shipicon",this.shipId.split("|")[0])]);const i=[this.gear1,this.gear2,this.gear3,this.gear4,this.gear5,this.fuckaug];await Promise.all(i.map(async l=>{s.push(await this.fetch_or_black(l==this.fuckaug?"spweapon":"equips",l.split("|")[0]))}));let t=[`aff ${Number(this.shipId.split("|")[2])/100}`],a=[this.shipId.split("|")[1]];i.forEach(l=>{let m=l.split("|")[0],u=l.split("|")[1];t.push(m!="0"?`+${u}`:""),a.push("")});let e=20,n=71*s.length,o=71+e*2;const h=document.createElement("canvas");h.width=n,h.height=o;const p=h.getContext("2d");if(!p)return h;p.fillStyle="white",p.fillRect(0,0,n,o),p.font="14px Arial",p.fillStyle="black";for(let l=0;l<s.length;l++){p.drawImage(s[l],l*71,20,71,71);let m=p.measureText(t[l]),u=m.width;p.fillText(t[l],l*71+(71-u)/2,14),m=p.measureText(a[l]),u=m.width,p.fillText(a[l],l*71+(71-u)/2,71+e+14)}return h}}async function U(r,s,i){const t=r.outputName;console.log("Parsing string: ",r.fleetBuilderLink.split("?AFLD=")[1]),console.log("Parsed: ",j.decompressFromEncodedURIComponent(r.fleetBuilderLink.split("?AFLD=")[1]));let a=JSON.parse(j.decompressFromEncodedURIComponent(r.fleetBuilderLink.split("?AFLD=")[1]).split("!")[0]);a.length==1?a=a[0]:a=a[Number(t.split(" - fleet ")[-1])-1];let e=a[0].map(f=>new y(f));for(;e.length<3;)e.push(new y([]));let n=a[1].map(f=>new y(f));for(;n.length<3;)n.push(new y([]));let o=await Promise.all(e.map(f=>f.getImages())),h=await Promise.all(n.map(f=>f.getImages()));const p=o[0].width*2,l=o[0].height*3,m=document.createElement("canvas");m.width=p,m.height=l;const u=m.getContext("2d");if(!u)return m;u.fillStyle="white",u.fillRect(0,0,p,l),u.font="14px Arial",u.fillStyle="black";for(let f=0;f<2;f++)for(let d=0;d<3;d++)f==0?u.drawImage(h[d],0,d*h[d].height):u.drawImage(o[d],o[d].width,d*o[d].height);return m}function B(r,s,i){const t=r.outputName;let a={};return Object.keys(x[t][0].Statistics).forEach(e=>{a[e]=new it(e)}),x[t].forEach(e=>{Object.keys(e.Statistics).forEach(n=>{a[n].addTest(e.Statistics[n])})}),a=Object.fromEntries(Object.entries(a).sort(([e,n],[o,h])=>e.localeCompare(o))),A.map(e=>(console.log(e),at[e][1](x,t,a)))}function J(r){return L.map(s=>rt[s][1](r,x))}let S={},N=D(),R=D(),P=[],A=[],L=[];try{[P,A,L]=j.decompressFromEncodedURIComponent(window.location.hash.split("code=")[1]).split("!").map(r=>JSON.parse(r))}catch(r){console.log("error decoding code: ",window.location.hash.split("code=")[1],r),nt("#/view")}console.log(P,A,L),c=c.filter(r=>P.includes(r.outputName)),z().then(async()=>{await Promise.all(c.map(async(r,s)=>{S[r.outputName]=[await U(r,s,c.length)],S[r.outputName].push(...await Promise.all(B(r,s,c.length)))})),c.forEach(r=>{const s=document.createElement("div"),i=document.createElement("h1");i.innerText=r.outputName,s.replaceChildren(i,...S[r.outputName]),b(N).appendChild(s)}),b(R).replaceChildren(...await Promise.all(J(c)))}),et();var T=lt(),G=Y(T);W(G,r=>O(N,r),()=>b(N));var K=tt(G,2);W(K,r=>O(R,r),()=>b(R)),V(_,T),Z()}export{dt as component};
