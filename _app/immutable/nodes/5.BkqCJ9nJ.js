var K=Object.defineProperty;var H=(_,g,c)=>g in _?K(_,g,{enumerable:!0,configurable:!0,writable:!0,value:c}):_[g]=c;var w=(_,g,c)=>H(_,typeof g!="symbol"?g+"":g,c);import{t as M,a as Q}from"../chunks/Bxcs4qUw.js";import"../chunks/H9DnfBHD.js";import{p as V,g as v,f as X,a as Y,m as L,s as Z,b as W}from"../chunks/D8fYKh4C.js";import{b as F}from"../chunks/bafgH-e6.js";import{i as tt}from"../chunks/Co0_FZdz.js";import{R as et,a as O,l as at,b as st,I as rt,G as it,S as nt}from"../chunks/DXMai7gZ.js";import{g as lt}from"../chunks/BYQOIhAv.js";var ot=M("<div></div> <div></div>",1);function wt(_,g){V(g,!1);let c=et;c=c.filter(r=>r.outputName in O);let x=O;function A(r,a=!0){return new Promise((i,t)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>i(s),s.onerror=e=>t(e),s.src=`${a?"/":""}${r}`})}function $(r){const a=document.createElement("canvas");a.width=r.width,a.height=r.height;const i=a.getContext("2d");i&&i.drawImage(r,0,0);const t=new Image;return t.src=a.toDataURL(),t}function I(r,a,i){const t=document.createElement("canvas");t.width=r,t.height=a;const s=t.getContext("2d");return s&&(s.fillStyle=i,s.fillRect(0,0,r,a)),t}let y,C,E,k;async function q(){y=await Promise.all([1,2,3,4,5].map(e=>A(`bg${e}.png`)));let r=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/ship_data.js")).text()).slice(18,-1),a=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/equip_data.js")).text()).slice(19,-1),i=(await(await fetch("https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/js/sp_weapon_data.js")).text()).slice(23,-1),t="",s={};r.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(":")[0],s[t]={}):t!=""&&e.startsWith("painting: ")?s[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(s[t].rarity=Number(e.slice(-2,-1)))}),C=s,s={},t="",a.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(":")[0],s[t]={}):t!=""&&e.startsWith("icon: ")?s[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(s[t].rarity=Number(e.slice(-2,-1)))}),E=s,s={},t="",i.split(`
`).forEach(e=>{e=e.trim(),e.includes(": {")?(t=e.split(": {")[0],s[t]={}):t!=""&&e.startsWith("icon: ")?s[t].icon=e.split("'")[1]:t!=""&&e.startsWith("rarity: ")&&(s[t].rarity=Number(e.slice(-2,-1)))}),k=s}class b{constructor(a){w(this,"shipId","");w(this,"gear1","");w(this,"gear2","");w(this,"gear3","");w(this,"gear4","");w(this,"gear5","");w(this,"fuckaug","");function i(t){if(t==1)return 0;if(t==2)return 6100;if(t==3)return 8100;if(t==4)return 1e4;if(t==5)return 10100;if(t==6)return 2e4}a&&a.length>1&&(this.shipId=`${a[0]}|${parseInt(a[7].slice(0,2),16)}|${i(a[8])}`,this.gear1=`${a[1]}|${parseInt(a[7][2],16)}`,this.gear2=`${a[2]}|${parseInt(a[7][3],16)}`,this.gear3=`${a[3]}|${parseInt(a[7][4],16)}`,this.gear4=`${a[4]}|${parseInt(a[7][5],16)}`,this.gear5=`${a[5]}|${parseInt(a[7][6],16)}`,this.fuckaug=`${a[6]}|${parseInt(a[7][7],16)}`)}async fetch_or_black(a,i){function t(n){return n<0?n=0:n>4&&(n=4),n}if(i=="0")return I(71,71,"black");let s;a=="equips"?(s=$(y[t(E[i].rarity-2)]),i=E[i].icon):a=="shipicon"?(s=$(y[t(C[i].rarity-2)]),i=C[i].icon):(s=$(y[t(k[i].rarity-1)]),i=k[i].icon);const e=`https://raw.githubusercontent.com/Renhex/AzurLaneFleet/master/${a}/${i}.png`;try{const n=await A(e,!1),o=document.createElement("canvas");o.width=71,o.height=71;const h=o.getContext("2d");return h&&(h.drawImage(s,0,0,71,71),h.drawImage(n,0,0,71,71)),o}catch(n){return console.log(`Error fetching ${e}: ${n}`),I(71,71,"black")}}async getImages(){if(this.shipId=="")return I(71*7,111,"black");let a=await Promise.all([this.fetch_or_black("shipicon",this.shipId.split("|")[0])]);const i=[this.gear1,this.gear2,this.gear3,this.gear4,this.gear5,this.fuckaug];a.push(...await Promise.all(i.map(l=>this.fetch_or_black(l===this.fuckaug?"spweapon":"equips",l.split("|")[0]))));let t=[`aff ${Number(this.shipId.split("|")[2])/100}`],s=[this.shipId.split("|")[1]];i.forEach(l=>{let m=l.split("|")[0],u=l.split("|")[1];t.push(m!="0"?`+${u}`:""),s.push("")});let e=20,n=71*a.length,o=71+e*2;const h=document.createElement("canvas");h.width=n,h.height=o;const p=h.getContext("2d");if(!p)return h;p.fillStyle="white",p.fillRect(0,0,n,o),p.font="14px Arial",p.fillStyle="black";for(let l=0;l<a.length;l++){p.drawImage(a[l],l*71,20,71,71);let m=p.measureText(t[l]),u=m.width;p.fillText(t[l],l*71+(71-u)/2,14),m=p.measureText(s[l]),u=m.width,p.fillText(s[l],l*71+(71-u)/2,71+e+14)}return h}}async function z(r,a,i){const t=r.outputName;let s=st(!1,decodeURIComponent(r.fleetBuilderLink.split("?AFLD=")[1]));if(typeof s=="string")return I(71*2*7,71*3,"black");s.length==1?s=s[0]:s=s[Number(t.split(" - fleet ")[1])-1];let e=s[0].map(f=>new b(f));for(;e.length<3;)e.push(new b([]));let n=s[1].map(f=>new b(f));for(;n.length<3;)n.push(new b([]));let o=await Promise.all(e.map(f=>f.getImages())),h=await Promise.all(n.map(f=>f.getImages()));const p=o[0].width*2,l=o[0].height*3,m=document.createElement("canvas");m.width=p,m.height=l;const u=m.getContext("2d");if(!u)return m;u.fillStyle="white",u.fillRect(0,0,p,l),u.font="14px Arial",u.fillStyle="black";for(let f=0;f<2;f++)for(let d=0;d<3;d++)f==0?u.drawImage(h[d],0,d*h[d].height):u.drawImage(o[d],o[d].width,d*o[d].height);return m}function U(r,a,i){const t=r.outputName;let s={};return Object.keys(x[t][0].Statistics).forEach(e=>{s[e]=new nt(e)}),x[t].forEach(e=>{Object.keys(e.Statistics).forEach(n=>{s[n].addTest(e.Statistics[n])})}),s=Object.fromEntries(Object.entries(s).sort(([e,n],[o,h])=>e.localeCompare(o))),P.map(e=>rt[e][1](x,t,s))}function B(r){return T.map(a=>it[a][1](r,x))}let S={},N=L(),R=L(),j=[],P=[],T=[];try{[j,P,T]=at.decompressFromEncodedURIComponent(window.location.hash.split("code=")[1]).split("!").map(r=>JSON.parse(r))}catch(r){console.log("error decoding code: ",window.location.hash.split("code=")[1],r),lt("#/view")}console.log(j,P,T),c=c.filter(r=>j.includes(r.outputName)),q().then(async()=>{await Promise.all(c.map(async(r,a)=>{S[r.outputName]=[await z(r,a,c.length)],S[r.outputName].push(...await Promise.all(U(r,a,c.length)))})),c.forEach(r=>{const a=document.createElement("div"),i=document.createElement("h1");i.innerText=r.outputName,a.replaceChildren(i,...S[r.outputName]),v(N).appendChild(a)}),v(R).replaceChildren(...await Promise.all(B(c)))}),tt();var G=ot(),D=X(G);F(D,r=>W(N,r),()=>v(N));var J=Z(D,2);F(J,r=>W(R,r),()=>v(R)),Q(_,G),Y()}export{wt as component};
