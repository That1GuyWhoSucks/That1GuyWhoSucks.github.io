---
permalink: /voiceassist
---
{% include header.html %}
<p>This is the listener for my voice assistant. Multiple threads run this function and trade off listening to the mic and reading what was said.
    If it detects no speach it tells the commands processing threat to check the current commands list and execute commands as needed.
</p>
<pre><code>def getaudio(self):
    id = self.threadnum
    init_rec = sr.Recognizer()
    while True:
        if self.stop:
            break
        if self.mode == "mic":
            if not self.miclock:
                self.miclock = True
                print(f"th #{id} listening")
                with sr.Microphone() as source:
                    audio_data = init_rec.record(source, duration=4)
                self.miclock = False
                print(f"th #{id} calcing")
                try:
                    self.trans.append((init_rec.recognize_google(audio_data)).lower())
                    self.istalking = True
                except speech_recognition.UnknownValueError:
                    self.istalking = False
            else:
                tim.sleep(0.01)
        elif self.mode == "email":
            if not self.gmailock:
                thing = getmsg()
                if thing is not None:
                    self.trans.append(thing.lower())
                    print("got a thing")
            tim.sleep(1)
        elif self.mode == "console" and id == 1:
            self.trans.append(str(input(": ")).lower())
        else:
            tim.sleep(0.1)</code></pre>
